{% extends 'job_seeker/base.html'%}
{% load custom_tags %}
{% load static %}
{% block content %}
<div class='max-w-screen-xl items-center justify-between mx-auto p-4'>
  <div class='lg:w-full w-full sm:p-2 h-full my-2 flex items-center justify-center px-4 md:items-start md:justify-start md:p-20 flex-col'>
    <h1 class='md:text-6xl text-2xl sm:text-2xl font-extrabold mb-4 text-black'>To Choose <span class='text-indigo-600'>Right Jobs.</span> </h1>
    <p class='md:text-lg sm:text-sm text-xs mb-20 text-gray-400'>2400 Peoples are daily search in this portal, 100 user added job portal!</p>
    <div class='bg-white flex-col mb-6 w-full md:px-4 py-4 flex sm:flex-row items-center justify-center'>
      <form class="w-full" method="GET" action="#">
          <label for="default-search" class="mb-2 text-sm font-medium text-gray-900 sr-only dark:text-white">Search</label>
          <div class="relative">
              <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                  <svg class="w-4 h-4 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                      <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
                  </svg>
              </div>
              <input type="search" id="default-search" name="q" class="block w-full pl-10 pr-3 py-4 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" placeholder="Search Job..." value="{{ request.GET.q }}" required />
              <button type="submit" class="text-white absolute right-2.5 bottom-2.5 bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">Search</button>
          </div>
      </form>
    </div>
    <div class="w-full px-2 py-2 flex items-center justify-start flex-wrap searchResult">
      
          
    </div>
    <div class='w-full px-2 py-2 flex items-center justify-start flex-wrap'>
      <div class='flex items-center justify-center'>
        <svg xmlns="http://www.w3.org/2000/svg" class='text-indigo-600 text-xl mx-2' viewBox="0 0 20 20" fill="currentColor">
          <path d="M3 3a1 1 0 011-1h12a1 1 0 011 1v4a1 1 0 01-1 1h-2.5l-1.7 2.125a1 1 0 01-1.6 0L8.5 8H6a1 1 0 01-1-1V3H3z" />
          <path fill-rule="evenodd" d="M8 10a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1zm-1 3a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
        </svg>
        <h1 class='font-semibold text-lg'>Suggest Tag : </h1>
      </div>
      <div class='flex items-center justify-center px-4 flex-wrap'>
        <p class='px-2 text-gray-600'>Software</p>
        <p class='px-2 text-gray-600'>Marketing</p>
        <p class='px-2 text-gray-600'>UI/UX Design</p>
      </div>
    </div>
    <div class='w-full flex items-center justify-center flex-wrap'>
      {% if job_posts %}
        {% for job in job_posts %}
          <div class="m-5 lg:w-full md:w-1/2 sm:w-full">
            <div class="group mx-2 mt-10 grid max-w-screen-md grid-cols-12 space-x-8 overflow-hidden rounded-lg border py-8 text-gray-700 shadow transition hover:shadow-lg sm:mx-auto">
              <div class="col-span-11 flex flex-col pr-8 text-left sm:pl-4">
                <a href="{% url 'jobapp:job_detail_view' job_id=job.pk %}" class="mb-3 overflow-hidden pr-7 text-lg font-semibold sm:text-xl">{{ job.title }}</a>
                <p class="overflow-hidden pr-7 text-sm">{{ job.description|slice:":200" }}{% if job.description|length > 200 %}...{% endif %}</p>
                <div class="mt-5 flex flex-col space-y-3 text-sm font-medium text-gray-500 sm:flex-row sm:items-center sm:space-y-0 sm:space-x-2">
                  <a href="{% url 'jobapp:job_detail_view'  job_id=job.pk %}" class="inline-block">
                    <button
                      class="flex items-center gap-2 px-4 py-2 font-sans text-xs font-bold text-center text-gray-900 uppercase align-middle transition-all rounded-lg select-none text-white absolute mp-10 bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-4 py-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
                      type="button">
                      View Detail
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                        stroke="currentColor" class="w-4 h-4">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M17.25 8.25L21 12m0 0l-3.75 3.75M21 12H3"></path>
                      </svg>
                    </button>
                  </a>
                  <br/>
                </div>
                <div class="mt-5 flex flex-col space-y-3 text-sm font-medium text-gray-500 sm:flex-row sm:items-center sm:space-y-0 sm:space-x-2">
                  <div class="">Experience:
                    <span class="ml-2 mr-3 rounded-full bg-green-100 px-2 py-0.5 text-green-900">{{ job.experience_years }} years {{ job.experience_months }} months </span>
                  </div>
                  <div class="">
                    Skills:
                    {% for skill in job.skills.all %}
                      <span class="ml-2 mr-3 rounded-full bg-blue-100 px-2 py-0.5 text-blue-900">{{ skill }}</span>
                    {% endfor %}
                  </div>
                </div>
              </div>
            </div>
          </div>
        {% empty %}
          <p class='text-sm text-center font-semibold text-red-500'>Sorry, No jobs match your search criteria.</p>
        {% endfor %}
      {% endif %}
    </div>
  </div>  
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
  $(document).ready(function() {
    let debounce;
    $('#default-search').on('keydown', function (e) { 
      clearTimeout(debounce)
      debounce = setTimeout(() => {
              getAutoComplete();  
      }, 300);
    })
  })

  function getAutoComplete() {
          const query = $('#default-search').val();
          fetch(`/api/search/?search=${encodeURIComponent(query.trim())}`)
            .then((resp) => resp.json())
            .then((data) => {
                    $('.searchResult').empty();
                    for (let i = 0; i < data.count; i++) {
                            $('.searchResult').append(`<div class="flex items-center justify-between w-full p-2 lg:rounded-full md:rounded-full hover:bg-gray-100 cursor-pointer border-2 rounded-lg">
                                                    <div class="lg:flex md:flex items-center">
                                                    <div class="flex flex-col">
                                                        <div class="text-sm leading-3 text-gray-700 font-bold w-full">${data.results[i].title}</div>
                                                        <div class="text-xs text-gray-600 w-full">${data.results[i].description.substr(0,100)} ${(data.results[i].description.length>100)?'...':''}</div>
                                                    </div>
                                                    </div>
                                                    <a href="/job_detail/${data.results[i].id}">
                                                    <svg class="h-6 w-6 mr-1 invisible md:visible lg:visible xl:visible" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
                                                    </svg>
                                                    </a>
                                                    
                                                </div>`)
                    }
                  })
  }
</script>
{% endblock %}
